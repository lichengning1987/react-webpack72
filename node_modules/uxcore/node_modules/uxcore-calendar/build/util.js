'use strict';

var Formatter = require('uxcore-formatter');
var Tooltip = require('uxcore-tooltip');
var classnames = require('classnames');
var i18n = require('./locale');

/**
 * code should be an object like this {'xxxx-xx-xx': 'work/leave/schedule'}
 */
var generateContentRender = function generateContentRender(code) {
    var locale = arguments.length <= 1 || arguments[1] === undefined ? 'zh-cn' : arguments[1];

    return function contentRender(code, locale, current, value) {
        // see https://github.com/yiminghe/gregorian-calendar to get details about `current` API
        var time = current.getTime();
        var date = Formatter.date(time, 'YYYY-MM-DD');
        var type = code[date];
        if (typeof type == 'string') {
            type = [type];
        } else if (type == undefined) {
            type = [];
        }
        var tipMap = i18n[locale];
        var content = [];
        var isWork = type.indexOf('work') !== -1;
        var isLeave = type.indexOf('leave') !== -1;
        var isSchedule = type.indexOf('schedule') !== -1;
        content.push(React.createElement(
            'span',
            { key: 'date', className: classnames({
                    'kuma-calendar-date-content': true,
                    'work': isWork,
                    'leave': isLeave,
                    'schedule': isSchedule
                }) },
            current.getDayOfMonth()
        ));
        if (isSchedule) {
            content.push(React.createElement('span', { key: 'bottom-line', className: 'kuma-calendar-date-decoration' }));
        }

        if (isWork || isLeave) {
            return React.createElement(
                Tooltip,
                { placement: 'right', trigger: ["hover"], overlay: tipMap[isWork ? 'work' : 'leave'] },
                React.createElement(
                    'div',
                    { className: 'kuma-calendar-date-content-box' },
                    content
                )
            );
        } else {
            // only one child can be passed.
            return React.createElement(
                'div',
                { className: 'kuma-calendar-date-content-box' },
                content
            );
        }
    }.bind(null, code, locale);
};

module.exports = {
    generateContentRender: generateContentRender
};